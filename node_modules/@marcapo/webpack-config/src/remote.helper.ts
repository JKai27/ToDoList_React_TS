import { major, minor } from "semver";

const getCleanProjectName = (name: string) => name.replace("@marcapo/", "");
const getSuperCleanProjectName = (name: string) => name.replace("@marcapo/", "").replaceAll("-", "_");
const generateRemoteConfig = (remote: string) => {
	let versionString = remote;
	try {
		const packageLock = require("../../package-lock.json");
		const version = packageLock.version;
		console.log("package-lock-version: ", version);
		let requestedVersion = null;
		if (version === 3) {
			requestedVersion = packageLock.packages[`node_modules/${remote}`]?.version;
		} else if (version === 2) {
			requestedVersion = packageLock.dependencies[remote]?.version;
		}
		versionString = `/js/${getSuperCleanProjectName(remote)}/${major(requestedVersion)}.${minor(requestedVersion)}`;
	} catch (e) {
		console.error(e);
	}
	return {
		url: versionString,
		module: ".",
		scope: getCleanProjectName(remote),
	};
};

export { generateRemoteConfig };
